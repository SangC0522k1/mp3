console.clear();
// var _data = JSON.parse(
//     `{
//     "melody": [
//         [
//             {
//                 "line": "",
//                 "time": -1
//             }
//         ],
//         [
//             {
//                 "line": "1  ",
//                 "time": 31144
//             },
//             {
//                 "line": "2  ",
//                 "time": 32144
//             },
//             {
//                 "line": "3",
//                 "time": 33144
//             }
//         ],
//         [
//             {
//                 "line": "Há»“n ",
//                 "time": 35144
//             },
//             {
//                 "line": "lá»¡ ",
//                 "time": 35587.997
//             },
//             {
//                 "line": "sa ",
//                 "time": 36006
//             },
//             {
//                 "line": "vÃ o ",
//                 "time": 36475.998
//             },
//             {
//                 "line": "Ä‘Ã´i ",
//                 "time": 36972
//             },
//             {
//                 "line": "máº¯t ",
//                 "time": 37495
//             },
//             {
//                 "line": "em ",
//                 "time": 37939
//             }
//         ],
//         [
//             {
//                 "line": "Chiá»u ",
//                 "time": 42641
//             },
//             {
//                 "line": "nao ",
//                 "time": 43085
//             },
//             {
//                 "line": "xÃµa ",
//                 "time": 43476.997
//             },
//             {
//                 "line": "tÃ³c ",
//                 "time": 43869
//             },
//             {
//                 "line": "ngá»“i ",
//                 "time": 44443
//             },
//             {
//                 "line": "bÃªn ",
//                 "time": 45017.998
//             },
//             {
//                 "line": "rÃ¨m ",
//                 "time": 45488
//             }
//         ],
//         [
//             {
//                 "line": "Tháº§m ",
//                 "time": 49276
//             },
//             {
//                 "line": "Æ°á»›c ",
//                 "time": 49694
//             },
//             {
//                 "line": "nhÆ°ng ",
//                 "time": 50059.998
//             },
//             {
//                 "line": "nÃ o ",
//                 "time": 50503.998
//             },
//             {
//                 "line": "Ä‘Ã¢u ",
//                 "time": 51026
//             },
//             {
//                 "line": "dÃ¡m ",
//                 "time": 51575
//             },
//             {
//                 "line": "nÃ³i ",
//                 "time": 52097
//             }
//         ],
//         [
//             {
//                 "line": "KhÃ©p ",
//                 "time": 53325
//             },
//             {
//                 "line": "tÃ¢m ",
//                 "time": 53769
//             },
//             {
//                 "line": "tÆ° ",
//                 "time": 54370
//             },
//             {
//                 "line": "láº¡i ",
//                 "time": 54971
//             },
//             {
//                 "line": "thÃ´i ",
//                 "time": 55415
//             }
//         ],
//         [
//             {
//                 "line": "ÄÆ°á»ng ",
//                 "time": 56669
//             },
//             {
//                 "line": "hoa ",
//                 "time": 57139
//             },
//             {
//                 "line": "váº«n ",
//                 "time": 57766
//             },
//             {
//                 "line": "chÆ°a ",
//                 "time": 57922
//             },
//             {
//                 "line": "má»Ÿ ",
//                 "time": 58471
//             },
//             {
//                 "line": "lá»‘i ",
//                 "time": 58940.998
//             }
//         ],
//         [
//             {
//                 "line": "Äá»i ",
//                 "time": 62572
//             },
//             {
//                 "line": "láº¯m ",
//                 "time": 63042
//             },
//             {
//                 "line": "phong ",
//                 "time": 63408
//             },
//             {
//                 "line": "tráº§n ",
//                 "time": 63800
//             },
//             {
//                 "line": "tay ",
//                 "time": 64349.01
//             },
//             {
//                 "line": "tráº¯ng ",
//                 "time": 64949.005
//             },
//             {
//                 "line": "tay ",
//                 "time": 65289
//             }
//         ],
//         [
//             {
//                 "line": "Trá»i ",
//                 "time": 69260
//             },
//             {
//                 "line": "Ä‘Ã´ng ",
//                 "time": 69730
//             },
//             {
//                 "line": "ngáº¡i ",
//                 "time": 70122
//             },
//             {
//                 "line": "giÃ³ ",
//                 "time": 70513
//             },
//             {
//                 "line": "lÃ¹a ",
//                 "time": 71036
//             },
//             {
//                 "line": "vai ",
//                 "time": 71637
//             },
//             {
//                 "line": "gáº§y ",
//                 "time": 72133
//             }
//         ],
//         [
//             {
//                 "line": "Láº§u ",
//                 "time": 75973
//             },
//             {
//                 "line": "kÃ­n ",
//                 "time": 76391.01
//             },
//             {
//                 "line": "trÄƒng ",
//                 "time": 76783.005
//             },
//             {
//                 "line": "vá» ",
//                 "time": 77149
//             },
//             {
//                 "line": "khÃ´ng ",
//                 "time": 77723
//             },
//             {
//                 "line": "lá»‘i ",
//                 "time": 78272
//             },
//             {
//                 "line": "chiáº¿u ",
//                 "time": 78768.005
//             }
//         ],
//         [
//             {
//                 "line": "GÃ¡c ",
//                 "time": 80100.006
//             },
//             {
//                 "line": "cao ",
//                 "time": 80518.005
//             },
//             {
//                 "line": "ngÄƒn ",
//                 "time": 81171.005
//             },
//             {
//                 "line": "niá»m ",
//                 "time": 81746
//             },
//             {
//                 "line": "yÃªu ",
//                 "time": 82269.005
//             }
//         ],
//         [
//             {
//                 "line": "ThÃ¬ ",
//                 "time": 83444
//             },
//             {
//                 "line": "thÃ´i ",
//                 "time": 83880
//             },
//             {
//                 "line": "mÆ¡ ",
//                 "time": 84515
//             },
//             {
//                 "line": "Æ°á»›c ",
//                 "time": 84672.005
//             },
//             {
//                 "line": "chi ",
//                 "time": 85168
//             },
//             {
//                 "line": "nhiá»u ",
//                 "time": 85769.005
//             }
//         ],
//         [
//             {
//                 "line": "BÃªn ",
//                 "time": 91411
//             },
//             {
//                 "line": "nhau ",
//                 "time": 92117.004
//             },
//             {
//                 "line": "sao ",
//                 "time": 93292
//             },
//             {
//                 "line": "tÃ¬nh ",
//                 "time": 93815
//             },
//             {
//                 "line": "xa ",
//                 "time": 94416
//             },
//             {
//                 "line": "váº¡n ",
//                 "time": 95042
//             },
//             {
//                 "line": "lÃ½ ",
//                 "time": 95539
//             }
//         ],
//         [
//             {
//                 "line": "cÃ¡ch ",
//                 "time": 96740.005
//             },
//             {
//                 "line": "biá»‡t ",
//                 "time": 97263
//             },
//             {
//                 "line": "máº¥y ",
//                 "time": 97838.005
//             },
//             {
//                 "line": "sÆ¡n ",
//                 "time": 98491.005
//             },
//             {
//                 "line": "khÃª ",
//                 "time": 98935.005
//             }
//         ],
//         [
//             {
//                 "line": "NgÃ y ",
//                 "time": 101233
//             },
//             {
//                 "line": "Ä‘i ",
//                 "time": 102148
//             },
//             {
//                 "line": "máº¯t ",
//                 "time": 103349.01
//             },
//             {
//                 "line": "em ",
//                 "time": 103767.006
//             },
//             {
//                 "line": "xanh ",
//                 "time": 104473
//             },
//             {
//                 "line": "biá»ƒn ",
//                 "time": 105126
//             },
//             {
//                 "line": "sÃ¢u, ",
//                 "time": 105596
//             }
//         ],
//         [
//             {
//                 "line": "máº¯t ",
//                 "time": 106719
//             },
//             {
//                 "line": "tÃ´i ",
//                 "time": 107137
//             },
//             {
//                 "line": "rÆ°ng ",
//                 "time": 107921.005
//             },
//             {
//                 "line": "rÆ°ng ",
//                 "time": 108469
//             },
//             {
//                 "line": "sáº§u ",
//                 "time": 108913
//             }
//         ],
//         [
//             {
//                 "line": "Láº·ng ",
//                 "time": 110455
//             },
//             {
//                 "line": "nghe ",
//                 "time": 111108
//             },
//             {
//                 "line": "tiáº¿ng ",
//                 "time": 111709
//             },
//             {
//                 "line": "phÃ¡o ",
//                 "time": 112205
//             },
//             {
//                 "line": "tiá»…n ",
//                 "time": 112962.006
//             },
//             {
//                 "line": "ai ",
//                 "time": 113824.005
//             },
//             {
//                 "line": "qua ",
//                 "time": 114582
//             },
//             {
//                 "line": "cáº§u ",
//                 "time": 114922.005
//             }
//         ],
//         [
//             {
//                 "line": "ÄÆ°á»ng ",
//                 "time": 115496
//             },
//             {
//                 "line": "phá»‘ ",
//                 "time": 116228.004
//             },
//             {
//                 "line": "muÃ´n ",
//                 "time": 116724.01
//             },
//             {
//                 "line": "mÃ u ",
//                 "time": 117064
//             },
//             {
//                 "line": "sao ",
//                 "time": 117534.004
//             },
//             {
//                 "line": "thiáº¿u ",
//                 "time": 118082
//             },
//             {
//                 "line": "em ",
//                 "time": 118579
//             }
//         ],
//         [
//             {
//                 "line": "Vá» ",
//                 "time": 122628.006
//             },
//             {
//                 "line": "Ä‘Ã¢u ",
//                 "time": 123046.005
//             },
//             {
//                 "line": "lÃ n ",
//                 "time": 123464.005
//             },
//             {
//                 "line": "tÃ³c ",
//                 "time": 123882
//             },
//             {
//                 "line": "xÃµa ",
//                 "time": 124404
//             },
//             {
//                 "line": "bÃªn ",
//                 "time": 124979.004
//             },
//             {
//                 "line": "rÃ¨m ",
//                 "time": 125449.005
//             }
//         ],
//         [
//             {
//                 "line": "Láº§u ",
//                 "time": 129263
//             },
//             {
//                 "line": "váº¯ng ",
//                 "time": 129707
//             },
//             {
//                 "line": "khÃ´ng ",
//                 "time": 130073
//             },
//             {
//                 "line": "ngÆ°á»i ",
//                 "time": 130464
//             },
//             {
//                 "line": "song ",
//                 "time": 131118
//             },
//             {
//                 "line": "khÃ©p ",
//                 "time": 131666
//             },
//             {
//                 "line": "kÃ­n ",
//                 "time": 132189.01
//             }
//         ],
//         [
//             {
//                 "line": "Nhá»› ",
//                 "time": 133469.01
//             },
//             {
//                 "line": "em ",
//                 "time": 133913.01
//             },
//             {
//                 "line": "tÃ´i ",
//                 "time": 134461
//             },
//             {
//                 "line": "gá»i ",
//                 "time": 135088
//             },
//             {
//                 "line": "tÃªn ",
//                 "time": 135584
//             }
//         ],
//         [
//             {
//                 "line": "Chá»‰ ",
//                 "time": 136708.01
//             },
//             {
//                 "line": "nghe ",
//                 "time": 137204.01
//             },
//             {
//                 "line": "tiáº¿ng ",
//                 "time": 137857.01
//             },
//             {
//                 "line": "lÃ¡ ",
//                 "time": 138171
//             },
//             {
//                 "line": "rÆ¡i ",
//                 "time": 139059
//             },
//             {
//                 "line": "thá»m ",
//                 "time": 139581.01
//             }
//         ],
//         [
//             {
//                 "line": "BÃªn ",
//                 "time": 168107.01
//             },
//             {
//                 "line": "nhau ",
//                 "time": 169021
//             },
//             {
//                 "line": "sao ",
//                 "time": 170066.01
//             },
//             {
//                 "line": "tÃ¬nh ",
//                 "time": 170484.01
//             },
//             {
//                 "line": "xa ",
//                 "time": 171111.01
//             },
//             {
//                 "line": "váº¡n ",
//                 "time": 171738
//             },
//             {
//                 "line": "lÃ½ ",
//                 "time": 172208.01
//             }
//         ],
//         [
//             {
//                 "line": "cÃ¡ch ",
//                 "time": 173358
//             },
//             {
//                 "line": "biá»‡t ",
//                 "time": 173828
//             },
//             {
//                 "line": "máº¥y ",
//                 "time": 174429
//             },
//             {
//                 "line": "sÆ¡n ",
//                 "time": 175134
//             },
//             {
//                 "line": "khÃª ",
//                 "time": 175552
//             }
//         ],
//         [
//             {
//                 "line": "NgÃ y ",
//                 "time": 177981
//             },
//             {
//                 "line": "Ä‘i ",
//                 "time": 178713
//             },
//             {
//                 "line": "máº¯t ",
//                 "time": 180019
//             },
//             {
//                 "line": "em ",
//                 "time": 180489
//             },
//             {
//                 "line": "xanh ",
//                 "time": 181090
//             },
//             {
//                 "line": "biá»ƒn ",
//                 "time": 181743
//             },
//             {
//                 "line": "sÃ¢u, ",
//                 "time": 182161
//             }
//         ],
//         [
//             {
//                 "line": "máº¯t ",
//                 "time": 183389
//             },
//             {
//                 "line": "tÃ´i ",
//                 "time": 183833.01
//             },
//             {
//                 "line": "rÆ°ng ",
//                 "time": 184460
//             },
//             {
//                 "line": "rÆ°ng ",
//                 "time": 185087
//             },
//             {
//                 "line": "sáº§u ",
//                 "time": 185531
//             }
//         ],
//         [
//             {
//                 "line": "Láº·ng ",
//                 "time": 187150.01
//             },
//             {
//                 "line": "nghe ",
//                 "time": 187856
//             },
//             {
//                 "line": "tiáº¿ng ",
//                 "time": 188378
//             },
//             {
//                 "line": "phÃ¡o ",
//                 "time": 188639
//             },
//             {
//                 "line": "tiá»…n ",
//                 "time": 189031
//             },
//             {
//                 "line": "ai ",
//                 "time": 189580
//             },
//             {
//                 "line": "qua ",
//                 "time": 189971.01
//             },
//             {
//                 "line": "cáº§u ",
//                 "time": 191878
//             }
//         ],
//         [
//             {
//                 "line": "ÄÆ°á»ng ",
//                 "time": 192479
//             },
//             {
//                 "line": "phá»‘ ",
//                 "time": 192949
//             },
//             {
//                 "line": "muÃ´n ",
//                 "time": 193472
//             },
//             {
//                 "line": "mÃ u ",
//                 "time": 193864
//             },
//             {
//                 "line": "sao ",
//                 "time": 194464
//             },
//             {
//                 "line": "thiáº¿u ",
//                 "time": 195039
//             },
//             {
//                 "line": "em ",
//                 "time": 195536
//             }
//         ],
//         [
//             {
//                 "line": "Vá» ",
//                 "time": 199271
//             },
//             {
//                 "line": "Ä‘Ã¢u ",
//                 "time": 199689.01
//             },
//             {
//                 "line": "lÃ n ",
//                 "time": 200133
//             },
//             {
//                 "line": "tÃ³c ",
//                 "time": 200525.01
//             },
//             {
//                 "line": "xÃµa ",
//                 "time": 201047
//             },
//             {
//                 "line": "bÃªn ",
//                 "time": 201622.01
//             },
//             {
//                 "line": "rÃ¨m ",
//                 "time": 202144
//             }
//         ],
//         [
//             {
//                 "line": "Láº§u ",
//                 "time": 205932
//             },
//             {
//                 "line": "váº¯ng ",
//                 "time": 206350
//             },
//             {
//                 "line": "khÃ´ng ",
//                 "time": 206742
//             },
//             {
//                 "line": "ngÆ°á»i ",
//                 "time": 207108
//             },
//             {
//                 "line": "song ",
//                 "time": 207709
//             },
//             {
//                 "line": "khÃ©p ",
//                 "time": 208336
//             },
//             {
//                 "line": "kÃ­n ",
//                 "time": 208806
//             }
//         ],
//         [
//             {
//                 "line": "Nhá»› ",
//                 "time": 210033
//             },
//             {
//                 "line": "em ",
//                 "time": 210478
//             },
//             {
//                 "line": "tÃ´i ",
//                 "time": 211104
//             },
//             {
//                 "line": "gá»i ",
//                 "time": 211627
//             },
//             {
//                 "line": "tÃªn ",
//                 "time": 212149
//             }
//         ],
//         [
//             {
//                 "line": "Chá»‰ ",
//                 "time": 213429
//             },
//             {
//                 "line": "nghe ",
//                 "time": 213900.01
//             },
//             {
//                 "line": "tiáº¿ng ",
//                 "time": 214709
//             },
//             {
//                 "line": "lÃ¡ ",
//                 "time": 215284
//             },
//             {
//                 "line": "rÆ¡i ",
//                 "time": 215493
//             },
//             {
//                 "line": "thá»m ",
//                 "time": 215833.01
//             }
//         ],
//         [
//             {
//                 "line": "Láº§u ",
//                 "time": 219307
//             },
//             {
//                 "line": "váº¯ng ",
//                 "time": 219699
//             },
//             {
//                 "line": "khÃ´ng ",
//                 "time": 220117
//             },
//             {
//                 "line": "ngÆ°á»i ",
//                 "time": 220535
//             },
//             {
//                 "line": "song ",
//                 "time": 221162
//             },
//             {
//                 "line": "khÃ©p ",
//                 "time": 221684
//             },
//             {
//                 "line": "kÃ­n ",
//                 "time": 222233
//             }
//         ],
//         [
//             {
//                 "line": "Nhá»› ",
//                 "time": 223513
//             },
//             {
//                 "line": "em ",
//                 "time": 223904
//             },
//             {
//                 "line": "tÃ´i ",
//                 "time": 224558
//             },
//             {
//                 "line": "gá»i ",
//                 "time": 225184
//             },
//             {
//                 "line": "tÃªn ",
//                 "time": 225602
//             }
//         ],
//         [
//             {
//                 "line": "Chá»‰ ",
//                 "time": 226935
//             },
//             {
//                 "line": "nghe ",
//                 "time": 229051.01
//             },
//             {
//                 "line": "tiáº¿ng ",
//                 "time": 232969.01
//             },
//             {
//                 "line": "lÃ¡ ",
//                 "time": 234066.01
//             },
//             {
//                 "line": "rÆ¡i ",
//                 "time": 235137.01
//             },
//             {
//                 "line": "thá»m ",
//                 "time": 236522
//             }
//         ]
//     ]
// }`
// );

class LyricsTime {
    constructor (time,line){
        this.time = time;
        this.line = line;
    }
}

class Melody{
    constructor (melody){
        this.melody =melody;
    }
}

let lyricsData = [[new LyricsTime(-1,"")],
[new LyricsTime(31144,1),new LyricsTime(32144,2),new LyricsTime(33144,3)]];

var currentLine = "";
var currentWord = "";
let checkWord = true;

let xmlText ="";
fetch("assets/lyrics.xml").then(resp=>{
    resp.text().then(data =>{
        xmlText = data;
        let parse = new DOMParser();
        let xmlDom = parse.parseFromString(xmlText, "application/xml");
        let lyrics = xmlDom.querySelectorAll("data");
        lyrics.forEach((lyricsXmlParam) => {
            for (let i = 0; i < lyricsXmlParam.children.length; i++) {
                let lyricsArr =[];
              let sizeParam =
                lyricsXmlParam.children[i].getElementsByTagName("i").length;
                for(let j =0; j< sizeParam; j++){
                    let newLyrics = new LyricsTime(lyricsXmlParam.children[i].getElementsByTagName("i")[j].getAttribute("va"),
                    lyricsXmlParam.children[i].getElementsByTagName("i")[j].textContent);
                    lyricsArr.push(newLyrics);
                }
                lyricsArr[0] && lyricsData.push(lyricsArr);
            }
          });
 
    })
});

function align() {
    var a = $(".highlighted").height();
    var c = $(".content").height();
    var d =
        $(".highlighted").offset().top - $(".highlighted").parent().offset().top;
    var e = d + a / 2 - c / 2;
    $(".content").animate(
        { scrollTop: e + "px" },
        { easing: "swing", duration: 250 }
    );
}

var lyricHeight = $(".melody").height();
$(window).on("resize", function () {
    if ($(".melody").height() != lyricHeight) {
        lyricHeight = $(".melody").height();
        align();
    }
});

$(document).ready(function () {
    console.log(lyricsData);
let _data = new Melody(lyricsData);
    $("audio").on("timeupdate", function (e) {
        var time = this.currentTime * 1000;
        var past = _data.filter(function (item) {
            return item[0].time < time;
        });
        if (_data[past.length] != currentLine) {
            currentLine = _data[past.length];
            $(".melody div").removeClass("highlighted");
            $(`.melody div:nth-child(${past.length})`).addClass("highlighted");
            $(".melody div span").removeClass("runText");
            $(".melody div span").removeClass("runText2");
            $(".melody div span").removeClass("green");
            $(`.melody div:nth-child(${past.length}) span:nth-child(1)`).addClass("runText");

            let time1;
            if (past[past.length - 1].length === 1) {
                time1 = 500;
            } else {
                time1 = past[past.length - 1][1].time - past[past.length - 1][0].time
            }
            const element = document.querySelector('.runText')

            element.style.setProperty('--timeConsum', `run-text ${time1 / 1000}s forwards linear`)
            checkWord = true;
            align();
        } else {
            const element = document.querySelector('.runText');
            var row = past[past.length - 1].filter(function (item) {
                return item.time < time;
            });
            if (row[row.length - 1] != currentWord) {

                currentWord = row[row.length - 1];
                for (let i = 1; i < row.length; i++) {
                    $(`.melody div:nth-child(${past.length}) span:nth-child(${i})`).addClass("green");
                }
                if (checkWord) {
                    $(`.melody div:nth-child(${past.length}) span:nth-child(${row.length})`).addClass("runText");

                    let time2;
                    if (row.length === 1 || past[past.length - 1].length === row.length) {
                        time2 = 500;
                    } else {
                        time2 = past[past.length - 1][row.length - 1].time - past[past.length - 1][row.length - 2].time
                    }
                    element.style.setProperty('--timeConsum', `run-text ${time2 / 1000}s forwards linear`)
                    checkWord = false;
                } else {
                    $(`.melody div:nth-child(${past.length}) span:nth-child(${row.length})`).addClass("runText2");

                    let time3;
                    if (row.length === 1 || past[past.length - 1].length === row.length) {
                        time3 = 500;
                    } else {
                        time3 = past[past.length - 1][row.length - 1].time - past[past.length - 1][row.length - 2].time
                    }
                    element.style.setProperty('--timeConsum2', `run-text ${time3 / 1000}s forwards linear`)
                    checkWord = true;
                }


            }
        }
    });
});


pronounce();

function pronounce() {
    var html = "";
    for (var i = 0; i < lyricsData.length; i++) {
        html += "<div";
        if (i == 0) {
            html += ` class="highlighted"`;
            currentLine = 0;
        }
        html += ">";
        for (let j = 0; j < lyricsData[i].length; j++) {
            html += " <span "
            html += ` data-text="${lyricsData[i][j]["line"]}" >`;
            html +=
                lyricsData[i][j]["line"] == "" ? " ðŸŒ¸ " : lyricsData[i][j]["line"];
            html += " </span>"

        }
        html += "</div>";
    }
    $(".melody").html(html);
    align();
}

const playIconContainer = document.getElementById('play-icon');
const audioPlayerContainer = document.getElementById('audio-player');
const seekSlider = document.getElementById('seek-slider');
const muteIconContainer = document.getElementById('mute-icon');
let playState = 'play';
let muteState = 'unmute';

const playAnimation = bodymovin.loadAnimation({
    container: playIconContainer,
    path: 'https://maxst.icons8.com/vue-static/landings/animated-icons/icons/pause/pause.json',
    renderer: 'svg',
    loop: false,
    autoplay: false,
    name: "Play Animation",
});

const muteAnimation = bodymovin.loadAnimation({
    container: muteIconContainer,
    path: 'https://maxst.icons8.com/vue-static/landings/animated-icons/icons/mute/mute.json',
    renderer: 'svg',
    loop: false,
    autoplay: false,
    name: "Mute Animation",
});

playAnimation.goToAndStop(14, true);

playIconContainer.addEventListener('click', () => {
    if (playState === 'play') {
        audio.play();
        playAnimation.playSegments([14, 27], true);
        requestAnimationFrame(whilePlaying);
        playState = 'pause';
    } else {
        audio.pause();
        playAnimation.playSegments([0, 14], true);
        cancelAnimationFrame(raf);
        playState = 'play';
    }
});

muteIconContainer.addEventListener('click', () => {
    if (muteState === 'unmute') {
        muteAnimation.playSegments([0, 15], true);
        audio.muted = true;
        muteState = 'mute';
    } else {
        muteAnimation.playSegments([15, 25], true);
        audio.muted = false;
        muteState = 'unmute';
    }
});

const showRangeProgress = (rangeInput) => {
    if (rangeInput === seekSlider) audioPlayerContainer.style.setProperty('--seek-before-width', rangeInput.value / rangeInput.max * 100 + '%');
    else audioPlayerContainer.style.setProperty('--volume-before-width', rangeInput.value / rangeInput.max * 100 + '%');
}

seekSlider.addEventListener('input', (e) => {
    showRangeProgress(e.target);
});






const audio = document.querySelector('audio');
const durationContainer = document.getElementById('duration');
const currentTimeContainer = document.getElementById('current-time');
let raf = null;

const calculateTime = (secs) => {
    const minutes = Math.floor(secs / 60);
    const seconds = Math.floor(secs % 60);
    const returnedSeconds = seconds < 10 ? `0${seconds}` : `${seconds}`;
    return `${minutes}:${returnedSeconds}`;
}

const displayDuration = () => {
    durationContainer.textContent = calculateTime(audio.duration);
}

const setSliderMax = () => {
    seekSlider.max = Math.floor(audio.duration);
}

const displayBufferedAmount = () => {
    const bufferedAmount = Math.floor(audio.buffered.end(audio.buffered.length - 1));
    audioPlayerContainer.style.setProperty('--buffered-width', `${(bufferedAmount / seekSlider.max) * 100}%`);
}

const whilePlaying = () => {
    seekSlider.value = Math.floor(audio.currentTime);
    currentTimeContainer.textContent = calculateTime(seekSlider.value);
    audioPlayerContainer.style.setProperty('--seek-before-width', `${seekSlider.value / seekSlider.max * 100}%`);
    raf = requestAnimationFrame(whilePlaying);
}

if (audio.readyState > 0) {
    displayDuration();
    setSliderMax();
    displayBufferedAmount();
} else {
    audio.addEventListener('loadedmetadata', () => {
        displayDuration();
        setSliderMax();
        displayBufferedAmount();
    });
}

audio.addEventListener('progress', displayBufferedAmount);

seekSlider.addEventListener('input', () => {
    currentTimeContainer.textContent = calculateTime(seekSlider.value);
    if (!audio.paused) {
        cancelAnimationFrame(raf);
    }
});

seekSlider.addEventListener('change', () => {
    audio.currentTime = seekSlider.value;
    if (!audio.paused) {
        requestAnimationFrame(whilePlaying);
    }
});

